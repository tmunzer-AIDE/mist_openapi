# Tools Directory

This directory contains utility scripts for working with the Mist OpenAPI repository.

## Scripts

### api-doc-diff.sh

**Purpose**: Compare Mist API documentation files between two git tags from an external API repository.

**Description**: This script extracts documentation markdown files from two different git tags in a specified repository, saves them to a temporary directory, and opens VS Code for easy side-by-side comparison.

**Usage**:

Only contributors from Juniper/HPE with existing access to the specified repository will be able to run this.

```bash
./tools/api-doc-diff.sh <path> <from_tag> <to_tag>
```

**Arguments**:

- `path` - Path to the Mist API repository (must be a valid git repository).
- `from_tag` - Git tag to compare from (e.g., `v1.0.0`, `release-2023-01`).
- `to_tag` - Git tag to compare to (e.g., `v1.1.0`, `release-2023-02`).

**Example**:

```bash
./tools/api-doc-diff.sh /path/to/mist-api v1.0.0 v1.1.0
```

**What it does**:

1. Validates all input parameters and checks that the path is a valid git repository.
2. Checks if the specified tags exist locally; if not, fetches them from the remote repository.
3. Creates a secure temporary directory with random naming using `mktemp -d`.
4. Extracts the following documentation files from both tags:
   - `docs/src/Home.md`
   - `docs/src/Overview.md`
   - `docs/src/Auth.md`
   - `docs/src/Site.md`
   - `docs/src/Org.md`
   - `docs/src/MSP.md`
5. Opens VS Code with the temporary directory containing both versions.
6. Prints the location of extracted files for reference.
7. Returns to the original working directory.

**Features**:

- ✅ Automatic tag fetching from remote if not available locally.
- ✅ Secure temporary directory creation with random naming (prevents path traversal attacks).
- ✅ Filename validation to prevent path traversal in extracted files.
- ✅ Color-coded output (errors in red, warnings in yellow, success in green).
- ✅ Comprehensive error handling and validation.
- ✅ Graceful handling of missing files (creates `.missing` placeholder files with warnings).
- ✅ Progress indicators with checkmarks.

**Output Location**:

Files are extracted to a secure temporary directory with random naming: `/tmp/tmp.XXXXXXXXXX/<tag_name>/`.

Where `XXXXXXXXXX` is a random string generated by `mktemp` for security.

**Requirements**:

- Git must be installed and accessible in PATH.
- VS Code must be installed with the `code` command available.
- Network access to fetch tags from the remote repository (if tags don't exist locally).
- Read access to the target git repository.
- Write access to `/tmp` directory.

**Error Handling**:

- Missing parameters → displays usage help.
- Invalid path → exits with error message.
- Not a git repository → exits with error message.
- Non-existent tags (locally or on remote) → exits with error message.
- Failed tag fetch from remote → exits with error message.
- Invalid filename (path traversal attempt) → exits with error message.
- Missing files in a tag → warns but continues (useful for comparing different versions where files may have been added/removed).
